server {
  listen   80; ## listen for ipv4; this line is default and implied
  #listen   [::]:80 default ipv6only=on; ## listen for ipv6

  root <%= @kibana_root %>;

  index index.html index.htm;

  # Make site accessible from http://localhost/

  location /config.js {
    alias <%= @kibana_conf %>;
  }

  location /app/dashboards/ {
    alias <%= @kibana_dashboards %>;
  }

  location / {
    try_files $uri $uri/ /index.html;
  }

  location /es {
    # Deny access to Cluster API
    #    if ($request_filename ~ "_cluster") {
    #      return 403;
    #      break;
    #    }

    # Pass requests to ElasticSearch
    rewrite /es/(.*) /$1 break;
    proxy_pass <%= @elasticsearch_url %>;
    proxy_redirect off;

    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header  Host $http_host;
  }

}
